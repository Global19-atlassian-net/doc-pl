<?xml version="1.0" encoding="iso-8859-2"?>
<!-- $Revision: 1.1 $ -->
 <reference id="ref.session">
  <title>Sesje</title>
  <titleabbrev>Sesje</titleabbrev>
	
  <partintro>
   <para>
    Obs³uga sesji w PHP ma na celu zapewnienie sposobu na zachowanie pewnych
    danych w trakcie nastêpuj±cych po sobie wywo³añ strony. Pozwala to na
    budowanie bardziej spersonalizowanych aplikacji i zwiêkszenie
    atrakcyjno¶ci twojej strony internetowej.
   </para>
   <para>
    Je¶li jeste¶ zaznajomiony z zarz±dzaniem sesj± w PHPLIB, zauwa¿ysz ¿e
    pewnie koncepcje s± podobne w ob³udze sesji PHP.
   </para>
   <para>
    Go¶æ wchodz±cy na twoj± stronê WWW otrzymuje unikalny identyfikator, tzw.
    id sesji. Jest ono przechowywane albo jako ciasteczko po stronie
    u¿ytkownika lub propagowane w URL'u.
   </para>
   <para>
    Obs³uga sesji pozwala ci na rejestrowanie dowolnej ilo¶ci zmiennych, które
    maj± byæ przekazywane pomiêdzy stronami. Kiedy go¶æ wchodzi na twoj±
    strone, PHP automatycznie sprawdzi (je¶li session.auto_start jest ustawione
    na 1) lub na twoje ¿yczenie (jawnie przez wywo³anie
    <function>session_start</function> lub niejawnie przez wywo³anie
    <function>session_register</function>) czy specyficzne id sesji zosta³o
    przypisane. Je¶li tak, poprzednio zachowane ¶rodowisko jest odtwarzane.
   </para>
   <para>
    Wszystkie zarejestrowane zmienne s± serializowane po wykonaniu ca³ego kodu
    strony. Zarejestrowane zmienne, które s± niezdefiniowane, s± zaznaczane
    jako niezdefijiowane. Nie s± one definiowane przez modu³ sesji w
    nastêpuj±cych po sobie wywo³aniach, chyba ¿e u¿ytkownik zdefiniuje je
    pó¼niej.
   </para>
   <para>
    Opcje konfiguracyjne <link
    linkend="ini.track-vars"><literal>track_vars</literal></link> i
    <link
    linkend="ini.register-globals"><literal>register_globals</literal></link>
    wp³ywaj± na to, jak zmienne sesyjne s± przechowywane i odtwarzane.
   </para>

   <note>
    <para>
     Od PHP w wersji 4.0.3 opcja <link
     linkend="ini.track-vars"><literal>track_vars</literal></link> jest zawsze
     w³±czona.
    </para>
   </note>

   <para>
    Je¶li w³±czona jest opcja <link
    linkend="ini.track-vars"><literal>track_vars</literal></link> a
    <link
    linkend="ini.register-globals"><literal>register_globals</literal></link>
    jest wy³±czona, tylko pozycje nale¿±ce do zmiennej asocjacyjnej
    $HTTP_SESSION_VARS mog± byæ zarejestrowane jako zmienne sesyjne.
    Odtworzone zmienne sesyjne bêd± dostêpne tylko w zmiennej
    $HTTP_SESSION_VARS.
  <example>
     <title>
      Rejestracja zmiennej z w³±czon± opcj± <link
      linkend="ini.track-vars"><literal>track_vars</literal></link>
     </title>
     <programlisting role="php">
<![CDATA[
<?php
session_register("count");
$HTTP_SESSION_VARS["count"]++;
?>
]]>
     </programlisting>
    </example>
   </para>
   <para>
    Je¶li w³±czona jest opcja <link
    linkend="ini.register-globals"><literal>register_globals</literal></link>,
    wszystkie globalne zmienne mog± byæ zarejestrowane jako zmienne sesyjne a
    zmienne sesyjne bêd± odtworzone do odpowiadaj±cych im zmiennych
    globalnych.
  <example>
     <title>
      Rejestracja zminnych z w³±czon± opcj± <link
      linkend="ini.register-globals"><literal>register_globals</literal></link>
     </title>
     <programlisting role="php">
<![CDATA[
<?php
session_register("count");
$count++;
?>
]]>
     </programlisting>
    </example>
   </para>
   <para>
    Je¶li w³±czone s± obie opcje, <link
    linkend="ini.track-vars"><literal>track_vars</literal></link> i
    <link
    linkend="ini.register-globals"><literal>register_globals</literal></link>,
    globalne zmienne i wpisy w $HTTP_SESSION_VARS bêd± referencjami do tej
    samej warto¶ci.
   </para>
   <para>
    Istniej± dwie metody propagacji identyfikatora sesji:
    <itemizedlist>
     <listitem>
      <simpara>
       Ciasteczka
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       Parametry URL'a
      </simpara>
     </listitem>
    </itemizedlist>
   </para>
   <para>
    Modu³ sesji obs³uguje obie metody. Ciasteczka s± metod± optymaln±, ale
    poniewa¿ nie s± one pewne (klienci nie musz± ich akceptowaæ), nie mo¿emy
    na nich polegaæ. Druga metora wstawia identyfikatory sesji bezpo¶rednio do
    URL'i.
   </para>
   <para>
    PHP mo¿e to robiæ 'przezroczy¶cie' je¶li zosta³ skompilowany z opcj±
    <link linkend="install.configure.enable-trans-sid">
    <literal>--enable-trans-sid</literal></link>. Je¶li w³±czysz t± opcjê,
    wzglêdne URI zostan± automatycznie podmienione tak, aby zawiera³y
    identyfikator sesji. Mo¿esz tak¿e u¿yæ sta³ej <literal>SID</literal> która
    jest definiowana je¶li klient nie wys³a³ odpowiedniego ciastka. <literal>
    SID</literal> jest albo w postaci <literal>nazwa_sesji=id_sesji</literal>
    lub pustym stringiem.
   </para>
   <para>
    Poni¿szy przyk³ad demonstruje jak zarejestrowaæ zmienn± i jak prawid³owo
    wstawiæ link do kolejnej strony korzystaj±c ze sta³ej SID.
    <example>
     <title>Zliczanie ilo¶ci odwiedzin pojedyñczego u¿ytkownika</title>
     <programlisting role="php">
<![CDATA[
<?php
session_register ("count");
$count++;
?>

Witaj go¶ciu. Ogl±dasz t± stronê <?php echo $count; ?> raz.<p>

<?php
# <?=SID?> jest konieczne do zachowania identyfikatora sesji je¶li
# u¿ytkownik wy³±czy³ ciastka
?>

Aby kontynuowaæ, <A HREF="nextpage.php?<?=SID?>">kliknij tutaj</A>
]]>
     </programlisting>
    </example>
   </para>
   <para>
    <literal>&lt;?=SID?&gt;</literal> nie jest konieczne je¶li przy kompilacji
    PHP u¿yta zosta³a opcja
    <link linkend="install.configure.enable-trans-sid">
    <literal>--enable-trans-sid</literal></link>.
   </para>
   <note>
    <para>
     PHP zak³ada, ¿e bezwzglêdne URLe odnosz± siê do zewnêtrznych serwisów,
     wiêc nie trzeba przekazywaæ SID, poniewa¿ istnia³oby niebezpieczeñstwo
     podkradania SIDów przez inny serwer.
    </para>
   </note>
   <para>
    Aby zaimplementowaæ przechowywanie danych sesyjnych w bazie danych lub w
    dowolnej innej postaci, musisz u¿yæ
    <function>session_set_save_handler</function> do stworzenia zestawu
    funkcji przechowuj±cych dane.
   </para>
   <para>
    System zarz±dzania sesj± obs³uguje wiele opcji konfiguracyjnych, które
    mo¿esz wstawiæ do swojego pliku php.ini. Oto ich krótki przegl±d.
    <itemizedlist>
     <listitem>
      <simpara>
       <literal>session.save_handler</literal> definiuje nazwê procedury
       obs³ugi, która jest u¿ywana do przechowywania i odczytu danych
       skojarzonych z sesj±. Domy¶lnie <literal>files</literal>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.save_path</literal> definiuje argument, który jest
       przekazywany procedurze obs³ugi zapisu danych. Je¶li wybierzesz
       domy¶ln± procedurê obs³ugi, jest to ¶cie¿ka gdzie tworzone bêd± pliki z
       danymi. Domy¶lnie <literal>/tmp</literal>.
      </simpara>
      <warning>
       <para>
        Je¶li w tej opcji ustawisz katalog, który jest ogólnie dostêpny, jak
        na przyk³ad <filename>/tmp</filename> (domy¶lna warto¶æ), inni
        u¿ytkownicy serwera bêd± w stanie przechwyciæ sesjê przez pobranie
        listy plików z tego katalogu.
       </para>
      </warning>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.name</literal> okre¶la nazwê sesji, która jest u¿ywana
       jako nazwa ciastka. Powinna zawieraæ tylko znaki alfanumeryczne.
       Domy¶lnie <literal>PHPSESSID</literal>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.auto_start</literal> okre¶la, czy modu³ sesji
       rozpoczyna sesjê na pocz±tku wywo³ania. Domy¶lnie
       <literal>0</literal> (wy³±czony).
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.cookie_lifetime</literal> okre¶la d³ugo¶æ ¿ycia w
       sekundach ciastka przesy³anego do przegl±darki. Warto¶æ 0 oznacza
       "dopóki przegl±darka nie zosta³a zamkniêta". Domy¶lnie
       <literal>0</literal>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.serialize_handler</literal> okre¶la nazwê procedury
       obs³ugi, która zostanie u¿yta do serializacji/odserializacji danych.
       Obecnie obs³ugiwany jest wewnêtrzny format PHP (nazwa <literal>php
       </literal> i WDDX (nazwa <literal>wddx</literal>). WDDX jest jedynym
       dostêpnym formatem je¶li PHP zosta³o skompilowane z
       <link linkend="ref.wddx">obs³ug± WDDX</link>. Domy¶lnie
       <literal>php</literal>.
       </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.gc_probability</literal> okre¶la prawdopodobieñstwo w
       procentach rozpoczêcia procedury gc (garbage collection - zbieranie
       ¶mieci) przy ka¿dym wywo³aniu. Domy¶lnie <literal>1</literal>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.gc_maxlifetime</literal> okre¶la ilo¶æ sekund, po
       jakich dane bêd± rozpoznawane jako '¶mieci' i usuwane.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.referer_check</literal> zawiera podci±g, z którym
       HTTP_REFERER ma byæ sprawdzany. Je¶li HTTP_REFERER zosta³ wys³any przez
       klienta i nie zawiera³ podanego podci±gu, identyfikator sesji podany
       przez takiego klienta zostanie uznany za niewa¿ny. Domy¶lnie jest to
       ci±g pusty. 
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.entropy_file</literal> podaje ¶cie¿kê do zewnêtrznego
       zasobu (pliku), który bêdzie u¿yty jako dodatkowe ¼ród³o entropii w
       procesie tworzenia identyfikatora sesji. Przyk³ady to
       <literal>/dev/random</literal> lub
       <literal>/dev/urandom</literal>, które s± dostêpne na wielu systemach
       Unix.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.entropy_length</literal> okre¶la liczbê bajtów, która
       bêdzie odczytana z pliku podanego powy¿ej. Domy¶lnie
       <literal>0</literal> (wy³±czona).
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.use_cookies</literal> okre¶la czy modu³ bêdzie u¿ywa³
       ciasteczek do przechowywania identyfikatora sesji po stronie klienta.
       Domy¶lnie <literal>1</literal> (w³±czona).
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.cookie_path</literal> okre¶la ¶cie¿kê która bêdzie
       podana w session_cookie. Domy¶lnie <literal>/</literal>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.cookie_domain</literal> okre¶la domenê która ma byæ
       podana w session_cookie. Domy¶lnie - pusta.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.cache_limiter</literal> okre¶la metodê u¿ywan± do
       przechowywania stron sesyjnych w pamiêci podrêcznej 
       (nocache/private/private_no_expire/public). Domy¶lnie
       <literal>nocache</literal>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.cache_expire</literal> okre¶la czas ¿ycia w minutach
        stron sesyjnych zachowanych w pamiêci podrêcznej. Nie ma to efektu dla
        metody <literal>nocache</literal>. Domy¶lnie <literal>180</literal>
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.use_trans_sid</literal> okre¶la czy bêdzie u¿ywana
       obs³uga przezroczystego przekazywania identyfikatora sesji. Opcja brana
       pod uwagê tylko je¶li PHP zosta³o skompilowane z opcj±
       <link linkend="install.configure.enable-trans-sid">
       <literal>--enable-trans-sid</literal></link>.
       Domy¶lnie <literal>1</literal> (w³±czona).
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>url_rewriter.tags</literal> okre¶la które tagi HTML zostaj±
       przepisane w celu dopisania identyfikatora sesji je¶li w³±czona zosta³a
       opcja przezroczystego przekazywania identyfikatora sesji. Domy¶lnie
       <literal>a=href,area=href,frame=src,input=src,form=fakeentry</literal>
      </simpara>
     </listitem>
    </itemizedlist>
    <note>
     <para>
      Obs³uga sesji zosta³a dodana w PHP 4.0.
     </para>
    </note>
   </para>
  </partintro>








  

  








<!-- wykomentowane do czasu ostatecznej decyzji o implementacji
-->
&reference.session.functions;

 </reference>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil 
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

